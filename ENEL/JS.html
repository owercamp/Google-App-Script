<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
  integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
  integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.datatables.net/v/dt/dt-1.13.4/b-2.3.6/r-2.4.1/datatables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.3/sweetalert2.min.js"
  integrity="sha512-eN8dd/MGUx/RgM4HS5vCfebsBxvQB2yI0OS5rfmqfTo8NIseU+FenpNoa64REdgFftTY4tm0w8VMj5oJ8t+ncQ=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  $(document).ready(function () {
    let graphFramingham;
    let graphMetabolic;
    let graphArterogenic;
    let graphIntervention;
    $('div.sample').hide().first().show();

    $(document).on('click', 'a.display', function (e) {
      e.preventDefault();
      let that = $('div.sample:visible'),
        t = e.target.id;

      if (t == 'next' && that.next('div.sample').length > 0) {
        $('div.sample').hide().removeClass("select");
        that.next('div.sample').show().addClass("select");
      } else if (t == 'prev' && that.prev('div.sample').length > 0) {
        $('div.sample').hide().removeClass("select");
        that.hide().prev('div.sample').show().addClass("select");
      }
    });

    $('#central').select2({
      placeholder: 'Select an option',
      selectOnClose: true,
    });

    $('#FraminghamOpc').select2({
      placeholder: 'Select an option',
      selectOnClose: true,
    });

    $('#MetabolicOpc').select2({
      placeholder: 'Select an option',
      selectOnClose: true,
    });

    $('#AterogenicOpc').select2({
      placeholder: 'Select an option',
      selectOnClose: true,
    });

    $('#InterventionOpc').select2({
      placeholder: 'Select an option',
      selectOnClose: true,
    });
  })
  window.addEventListener("load", general(""));
  window.addEventListener("load", listCentrals());
  /*** instanciación de los DataTables ***/
  let tbl_general = $("#tbl_data").DataTable({
    language: {
      "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
    },
    columnDefs: [
      {
        className: "myCustomCenter", targets: "_all"
      }
    ],
    fixedColumns: true,
    responsive: true,
    pagingType: "full_numbers"
  });

  let tbl_framingham = $("#tbl_framingham").DataTable({
    language: {
      "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
    },
    columnDefs: [
      {
        className: "myCustomCenter", targets: "_all"
      },
      {
        orderable: false, targets: [1, 2]
      },
      {
        searchable: false, targets: [1, 2]
      }
    ],
    fixedColumns: true,
    responsive: true,
    pagingType: "full_numbers"
  });

  let tbl_metabolic = $("#tbl_metabolic").DataTable({
    language: {
      "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
    },
    columnDefs: [
      {
        className: "myCustomCenter", targets: "_all"
      },
      {
        orderable: false, targets: [1, 2]
      },
      {
        searchable: false, targets: [1, 2]
      }
    ],
    fixedColumns: true,
    responsive: true,
    pagingType: "full_numbers"
  });

  let tbl_aterogenic = $("#tbl_aterogenic").DataTable({
    language: {
      "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
    },
    columnDefs: [
      {
        className: "myCustomCenter", targets: "_all"
      },
      {
        orderable: false, targets: [1, 2]
      },
      {
        searchable: false, targets: [1, 2]
      }
    ],
    fixedColumns: true,
    responsive: true,
    pagingType: "full_numbers"
  });

  let tbl_intervention = $("#tbl_Intervention").DataTable({
    language: {
      "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
    },
    columnDefs: [
      {
        className: "myCustomCenter", targets: "_all"
      },
      {
        orderable: false, targets: [1, 2]
      },
      {
        searchable: false, targets: [1, 2]
      }
    ],
    fixedColumns: true,
    responsive: true,
    pagingType: "full_numbers"
  });

  let tbl_modal = $("#tbl_modal").DataTable({
    language: {
      "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
    },
    columnDefs: [
      { className: "myCustomCenter0", targets: 0 },
      { className: "myCustomCenter", targets: 1 }
    ],
    fixedColumns: true,
    responsive: true,
    pagingType: "full_numbers"
  });

  // Transforms the first letter of each word in a given string to uppercase and the rest of the letters to lowercase.

  // Parameters:
  // - info: a string that contains one or more words separated by spaces.

  // Returns:
  // - A new string where the first letter of each word is capitalized and the rest of the letters are lowercase.
  function firstLetter(info) {
    let letter = info.split(" ");
    let wordsConverted = letter.map(letter => letter.charAt(0).toUpperCase() + letter.slice(1).toLowerCase());
    let letterConverted = wordsConverted.join(" ");

    return letterConverted;
  }

  $(document).on("change", "#FraminghamOpc", function () {
    let evaluation = $(this).select2("data")[0].text;
    let central = $("#central").select2("data")[0].text;
    let selector = $(this).attr("name");

    Swal.fire({
      title: "Consultando...",
      text: `Consultando informacion de ${evaluation}`,
      icon: "info",
      showConfirmButton: false,
      showCancelButton: false,
      showDenyButton: false,
    });

    let framinghamResult = google.script.run.withSuccessHandler(result => {
      let information = JSON.parse(result);
      testFramingham(information, central, evaluation);
      Swal.fire({
        icon: 'success',
        title: "Good job!",
        showConfirmButton: false,
        timer: 2000
      });
    })
      .withFailureHandler(error => {
        console.log(error);
      })

    if (central) {
      framinghamResult.getGeneral(central);
    } else {
      framinghamResult.getGeneral();
    }
  })

  $(document).on("change", "#InterventionOpc", function () {
    let evaluation = $(this).select2("data")[0].text;
    let central = $("#central").select2("data")[0].text;
    let selector = $(this).attr("name");

    Swal.fire({
      title: "Consultando...",
      text: `Consultando informacion de ${evaluation}`,
      icon: "info",
      showConfirmButton: false,
      showCancelButton: false,
      showDenyButton: false,
    });

    let interventionResult = google.script.run.withSuccessHandler(result => {
      let information = JSON.parse(result);
      interventionInfo(information, central, evaluation);
      Swal.fire({
        icon: 'success',
        title: "Good job!",
        showConfirmButton: false,
        timer: 2000
      });
    })
      .withFailureHandler(error => {
        console.log(error);
      })

    if (central) {
      interventionResult.getGeneral(central);
    } else {
      interventionResult.getGeneral();
    }
  })

  $(document).on("change", "#MetabolicOpc", function () {
    let evaluation = $(this).select2("data")[0].text;
    let central = $("#central").select2("data")[0].text;
    let selector = $(this).attr("name");

    Swal.fire({
      title: "Consultando...",
      text: `Consultando informacion de ${evaluation}`,
      icon: "info",
      showConfirmButton: false,
      showCancelButton: false,
      showDenyButton: false,
    });

    let MetabolicResult = google.script.run.withSuccessHandler(result => {
      let information = JSON.parse(result);
      testMetabolic(information, central, evaluation);
      Swal.fire({
        icon: 'success',
        title: "Good job!",
        showConfirmButton: false,
        timer: 2000
      });
    })
      .withFailureHandler(error => {
        console.log(error);
      })

    if (central) {
      MetabolicResult.getGeneral(central);
    } else {
      MetabolicResult.getGeneral();
    }
  })

  $(document).on("change", "#AterogenicOpc", function () {
    let evaluation = $(this).select2("data")[0].text;
    let central = $("#central").select2("data")[0].text;
    let selector = $(this).attr("name");

    Swal.fire({
      title: "Consultando...",
      text: `Consultando informacion de ${evaluation}`,
      icon: "info",
      showConfirmButton: false,
      showCancelButton: false,
      showDenyButton: false,
    });

    let AterogenicResult = google.script.run.withSuccessHandler(result => {
      let information = JSON.parse(result);
      testAterogenic(information, central, evaluation);
      Swal.fire({
        icon: 'success',
        title: "Good job!",
        showConfirmButton: false,
        timer: 2000
      });
    })
      .withFailureHandler(error => {
        console.log(error);
      })

    if (central) {
      AterogenicResult.getGeneral(central);
    } else {
      AterogenicResult.getGeneral();
    }
  })

  $(document).on("click", "button.high", function () {
    let information = $(this).data("info");
    let title = $(this).data("central");
    let color = $(this).data("color");
    let evaluation = $(this).data("evaluation");
    let arrayInformation = information.split(",");
    $("#staticBackdropLabel").text(`${title} - ${evaluation.toUpperCase()}`);
    $("#staticBackdropLabel").parent(".modal-header").removeClass(`bg-danger bg-success bg-warning bg-dark`);
    $("#staticBackdropLabel").parent(".modal-header").addClass(`bg-${color}`);
    tbl_modal.clear().draw();

    arrayInformation.map(item => {
      let row = item.split("-");
      tbl_modal.row.add({
        0: row[0],
        1: row[1]
      }).draw();
    });
  });

  $(document).on("click", "button.infoGeneral", function () {
    let color = "";
    let management = $(this).data("gerencia");
    let review = $(this).data("examen");
    let central = $(this).data("central");
    let patient = $(this).data("paciente");
    let identification = $(this).data("identificacion");
    let charge = $(this).data("cargo");
    let sex = $(this).data("sexo");
    let age = $(this).data("edad");
    let framingham = $(this).data("framingham");
    let metabolic = $(this).data("metabolico");
    let aterogenic = $(this).data("aterogenico");
    let final = $(this).data("final");
    let months = $(this).data("months");
    let splitterMonths = months.split(",");
    switch (final) {
      case "BAJO":
        color = "text-bg-success";
        break;
      case "MEDIO":
        color = "text-bg-warning";
        break;
      case "ALTO":
        color = "text-bg-danger";
        break;
    }

    $("span#clasificacion").removeClass("text-bg-primary text-bg-success text-bg-warning text-bg-danger");

    $("h5#totalInfoLabel").text(management);
    $("span#examen").text(review);
    $("span#central").text(central);
    $("span#paciente").text(patient);
    $("span#identificacion").text(identification);
    $("span#cargo").text(charge);
    $("span#sexo").text(sex);
    $("span#edad").text(age);
    $("span#framingham").text(framingham);
    $("span#sindrome").text(metabolic);
    $("span#aterogenia").text(aterogenic);
    $("span#clasificacion").text(final).addClass(`${color}`);

    let pointer = 0, training = 1, dateThemeTraining = 3, workshop = 5, dateThemeWorkshop = 7, dateTracking = 9, diagnosticCV = 11, observationTracking = 13, valNutritional = 15, observationNutritional = 17, datePhysiotherapy = 19, observationPhysiotherapy = 21, datePsychology = 23, observationPsychology = 25, GYM = 27, increment = 29;

    $("div.accordion-item").each(function (index, element) {
      element.children.namedItem(splitterMonths[pointer]).removeChild(element.children.namedItem(splitterMonths[pointer]).children[0]);
      element.children.namedItem(splitterMonths[pointer]).appendChild(document.createElement(`div`)).innerHTML = `
        <div class="d-flex flex-column align-items-center p-2 gap-2">
          <div class="col-12 w-100 row gap-2">
            <div class="col-6 row">
              <b>${splitterMonths[training]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[training + 1] == "Sin Dato") ? " " : splitterMonths[training + 1]}</span>
            </div>
            <div class="col-6 row">
              <b>${splitterMonths[dateThemeTraining]}:</b>
            <span class="text-center border-bottom border-secondary">${(splitterMonths[dateThemeTraining + 1] == "Sin Dato") ? " " : splitterMonths[dateThemeTraining + 1].split("T")[0]}</span>
            </div>
          </div>
          <div class="col-12 w-100 row gap-2">
            <div class="col-6 row">
              <b>${splitterMonths[workshop]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[workshop + 1] == "Sin Dato") ? " " : splitterMonths[workshop + 1]}</span>
            </div>
            <div class="col-6 row">
              <b>${splitterMonths[dateThemeWorkshop]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[dateThemeWorkshop + 1] == "Sin Dato") ? " " : splitterMonths[dateThemeWorkshop + 1].split("T")[0]}</span>
            </div>
          </div>
          <div class="col-12 w-100 row gap-2">
            <div class="col-6 row">
              <b>${splitterMonths[dateTracking]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[dateTracking + 1] == "Sin Dato") ? " " : splitterMonths[dateTracking + 1].split("T")[0]}</span>
            </div>
            <div class="col-6 row">
              <b>${splitterMonths[observationTracking]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[observationTracking + 1] == "Sin Dato") ? " " : splitterMonths[observationTracking + 1]}</span>
            </div>            
          </div>
          <div class="col-12 w-100 row gap-2">
            <div class="col-6 row">
              <b>${splitterMonths[valNutritional]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[valNutritional + 1] == "Sin Dato") ? " " : splitterMonths[valNutritional + 1].split("T")[0]}</span>
            </div>
            <div class="col-6 row">
              <b>${splitterMonths[observationNutritional]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[observationNutritional + 1] == "Sin Dato") ? " " : splitterMonths[observationNutritional + 1]}</span>
            </div>
          </div>
          <div class="col-12 w-100 row gap-2">
            <div class="col-6 row">
              <b>${splitterMonths[datePhysiotherapy]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[datePhysiotherapy + 1] == "Sin Dato") ? " " : splitterMonths[datePhysiotherapy + 1].split("T")[0]}</span>
            </div>
            <div class="col-6 row">
              <b>${splitterMonths[observationPhysiotherapy]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[observationPhysiotherapy + 1] == "Sin Dato") ? " " : splitterMonths[observationPhysiotherapy + 1]}</span>
            </div>
          </div>
          <div class="col-12 w-100 row gap-2">
            <div class="col-6 row">
              <b>${splitterMonths[datePsychology]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[datePsychology + 1] == "Sin Dato") ? " " : splitterMonths[datePsychology + 1].split("T")[0]}</span>
            </div>
            <div class="col-6 row">
              <b>${splitterMonths[observationPsychology]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[observationPsychology + 1] == "Sin Dato") ? " " : splitterMonths[observationPsychology + 1]}</span>
            </div>
          </div>
          <div class="col-12 w-100 row gap-2">
            <div class="col-6 row">
              <b>${splitterMonths[diagnosticCV]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[diagnosticCV + 1] == "Sin Dato") ? " " : splitterMonths[diagnosticCV + 1]}</span>
            </div>
            <div class="col-6 row">
              <b>${splitterMonths[GYM]}:</b>
              <span class="text-center border-bottom border-secondary">${(splitterMonths[GYM + 1] == "Sin Dato") ? " " : splitterMonths[GYM + 1]}</span>
            </div>
          </div>
        </div>
      `;
      pointer += increment;
      training += increment;
      dateThemeTraining += increment;
      workshop += increment;
      dateThemeWorkshop += increment;
      dateTracking += increment;
      diagnosticCV += increment;
      observationTracking += increment;
      valNutritional += increment;
      observationNutritional += increment;
      datePhysiotherapy += increment;
      observationPhysiotherapy += increment;
      datePsychology += increment;
      observationPsychology += increment;
      GYM += increment;
    })
  })

  $(document).on("change", "#central", function () {
    const selection = $(this).select2('data');
    const centralSelection = selection[0].text;
    let response = "";
    Swal.fire({
      title: `¿Desea realizar la búsqueda por ${firstLetter(centralSelection)}?`,
      showCancelButton: true,
      confirmButtonText: `Buscar`,
      cancelButtonText: `Cancelar Busqueda`,
      allowOutsideClick: false,
      allowEscapeKey: false,
      confirmButtonColor: '#5391f5',
      cancelButtonColor: '#7e7f80',
    }).then((result) => {
      /* Read more about isConfirmed, isDenied below */
      if (result.isConfirmed) {
        Swal.fire({
          icon: 'info',
          html: `<p>Realizando consulta de los datos para la terminal <b style="color:Red;"><i>${firstLetter(centralSelection)}</i></b></p>`,
          footer: `<p style="color:#5faefe">Por favor espere..</p>`,
          showConfirmButton: false,
        });
        general(centralSelection);
      }
    });
  });

  // Retrieves a list of centrals from the server and populates the 'central' dropdown menu.
  function listCentrals() {
    let filter = [];
    google.script.run.withSuccessHandler(data => {
      let row = JSON.parse(data);
      $("#central").empty();
      $("#central").append(`<option value=""></option>`);
      $("#central").append(`<option value="TODAS">TODAS</option>`);
      row.forEach(element => {
        if (!filter.includes(element[3])) {
          filter.push(element[3]);
          $("#central").append(`<option value="${element[3]}">${element[3]}</option>`);
        }
      });
    })
      .withFailureHandler(error => {
        console.log(error);
      })
      .getCentrals();
  }

  const references = {
    HIGH: {
      High: "Alto",
      Counter: 0
    },
    MEDIUM: {
      Medium: "Medio",
      Moderate: "Moderado",
      Counter: 0
    },
    LOW: {
      Low: "Bajo",
      Counter: 0
    },
    NOLEVEL: {
      Counter: 0
    }
  }

  const referencesMetabolic = {
    withAlterations: {
      message: "Presenta SINDROME METABOLICO",
      Counter: 0
    },
    withoutAlterations: {
      message: "Sin Alteraciones",
      Counter: 0
    },
    requiredData: {
      message: "El valor VACIO",
      Counter: 0
    }
  }

  const referencesAterogenic = {
    "HIGH": {
      "High": "Maximo",
      "Counter": 0
    },
    "MEDIUM": {
      "Medium": "Moderado",
      "Counter": 0
    },
    "LOW": {
      "Low": "Minimo",
      "Counter": 0
    },
  }

  function testFramingham(params = "", central = "", status = "") {
    let centrals = [];
    let highValue = [];
    let mediumValue = [];
    let lowValue = [];
    let noLevelValue = [];
    let pushData = [];
    const framinghamChart = document.getElementById("myFramingham");

    if (central || status) {
      graphFramingham.destroy();
      tbl_framingham.clear().draw();
    }

    params.forEach(element => {
      if (!centrals.includes(element[3])) {
        centrals.push(element[3]);
      }
    })

    if (!status) {
      $("#FraminghamOpc").empty();
      $("#FraminghamOpc").append("<option value=''></option>");
      $("#FraminghamOpc").append("<option value='TODAS'>TODAS</option>");
      $("#FraminghamOpc").append(`<option value="${references.HIGH.High}">${references.HIGH.High}</option>`);
      $("#FraminghamOpc").append(`<option value="${references.MEDIUM.Moderate}">${references.MEDIUM.Moderate}</option>`);
      $("#FraminghamOpc").append(`<option value="${references.LOW.Low}">${references.LOW.Low}</option>`);
      $("#FraminghamOpc").append(`<option value="Sin Dato">Sin Dato</option>`);
    }

    let registerAdd = [];
    centrals.sort().forEach(central => {
      let highRegisters = [], mediumRegisters = [], lowRegisters = [], noLevelRegisters = [];
      references.HIGH.Counter = 0;
      references.MEDIUM.Counter = 0;
      references.LOW.Counter = 0;
      references.NOLEVEL.Counter = 0;
      params.forEach(register => {
        if (register[3] === central && register[25].includes(references.HIGH.High)) {
          if (status && register[25].includes(status)) {
            references.HIGH.Counter++;
            highRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            references.HIGH.Counter++;
            highRegisters.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[25].includes(references.MEDIUM.Moderate)) {
          if (status && register[25].includes(status)) {
            references.MEDIUM.Counter++;
            mediumRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            references.MEDIUM.Counter++;
            mediumRegisters.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[25].includes(references.LOW.Low)) {
          if (status && register[25].includes(status)) {
            references.LOW.Counter++;
            lowRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            references.LOW.Counter++;
            lowRegisters.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && ![references.HIGH.High, references.MEDIUM.Moderate, references.LOW.Low].includes(register[25])) {
          if (status && ![references.HIGH.High, references.MEDIUM.Moderate, references.LOW.Low].includes(status)) {
            references.NOLEVEL.Counter++;
            noLevelRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            references.NOLEVEL.Counter++;
            noLevelRegisters.push(`${register[7]}-${register[5]}`);
          }
        }
      })

      let btnHigh, btnMedium, btnLow, btnNoLevel;

      switch (status) {
        case references.HIGH.High:
          btnHigh = `0`;

          if (references.HIGH.Counter > 0) {
            btnHigh = `<button type="button" class="btn badge bg-danger rounded-pill high" data-info="${highRegisters}" data-color="danger" data-central="${central}" data-evaluation="${references.HIGH.High}"   data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.HIGH.Counter}</button>`;
          }

          registerAdd.push({
            0: central,
            1: references.HIGH.High,
            2: btnHigh
          })
          break;
        case references.MEDIUM.Moderate:
          btnMedium = `0`;

          if (references.MEDIUM.Counter > 0) {
            btnMedium = `<button type="button" class="btn badge bg-warning rounded-pill high" data-info="${mediumRegisters}" data-color="warning" data-central="${central}" data-evaluation="${references.MEDIUM.Moderate}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.MEDIUM.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: references.MEDIUM.Moderate,
            2: btnMedium
          })
          break;
        case references.LOW.Low:
          btnLow = `0`;

          if (references.LOW.Counter > 0) {
            btnLow = `<button type="button" class="btn badge bg-success rounded-pill high" data-info="${lowRegisters}" data-color="success" data-central="${central}" data-evaluation="${references.LOW.Low}"    data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.LOW.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: references.LOW.Low,
            2: btnLow
          })
          break;
        case 'Sin Dato':
          btnNoLevel = `0`;

          if (references.NOLEVEL.Counter > 0) {
            btnNoLevel = `<button type="button" class="btn badge bg-dark rounded-pill high" data-info="${noLevelRegisters}" data-color="dark" data-central="${central}" data-evaluation="SIN DATO" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.NOLEVEL.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: "Sin Dato",
            2: btnNoLevel
          })
          break;
        default:
          btnHigh = `0`;

          if (references.HIGH.Counter > 0) {
            btnHigh = `<button type="button" class="btn badge bg-danger rounded-pill high" data-info="${highRegisters}" data-color="danger" data-central="${central}" data-evaluation="${references.HIGH.High}"   data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.HIGH.Counter}</button>`;
          }

          registerAdd.push({
            0: central,
            1: references.HIGH.High,
            2: btnHigh
          })

          btnMedium = `0`;

          if (references.MEDIUM.Counter > 0) {
            btnMedium = `<button type="button" class="btn badge bg-warning rounded-pill high" data-info="${mediumRegisters}" data-color="warning" data-central="${central}" data-evaluation="${references.MEDIUM.Moderate}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.MEDIUM.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: references.MEDIUM.Moderate,
            2: btnMedium
          })

          btnLow = `0`;

          if (references.LOW.Counter > 0) {
            btnLow = `<button type="button" class="btn badge bg-success rounded-pill high" data-info="${lowRegisters}" data-color="success" data-central="${central}" data-evaluation="${references.LOW.Low}"    data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.LOW.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: references.LOW.Low,
            2: btnLow
          })

          btnNoLevel = `0`;

          if (references.NOLEVEL.Counter > 0) {
            btnNoLevel = `<button type="button" class="btn badge bg-dark rounded-pill high" data-info="${noLevelRegisters}" data-color="dark" data-central="${central}" data-evaluation="SIN DATO" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.NOLEVEL.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: "Sin Dato",
            2: btnNoLevel
          })
          break;
      }

      highValue.push(references.HIGH.Counter)
      mediumValue.push(references.MEDIUM.Counter)
      lowValue.push(references.LOW.Counter)
      noLevelValue.push(references.NOLEVEL.Counter)
    })

    let dataHigh, dataMedium, dataLow, dataNoLevel;

    /*** data for the High, Medium and Low graphs ***/
    dataHigh = {
      label: references.HIGH.High,
      data: highValue,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      borderColor: 'rgba(201, 14, 14, 0.7)',
      backgroundColor: 'rgba(201, 14, 14, 0.5)',
    }
    dataMedium = {
      label: references.MEDIUM.Moderate,
      data: mediumValue,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      borderColor: 'rgba(192, 201, 14, 0.7)',
      backgroundColor: 'rgba(192, 201, 14, 0.5)',
    }
    dataLow = {
      label: references.LOW.Low,
      data: lowValue,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      borderColor: 'rgba(17, 201, 14, 0.7)',
      backgroundColor: 'rgba(17, 201, 14, 0.5)',
    }
    dataNoLevel = {
      label: "Sin Dato",
      data: noLevelValue,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      borderColor: 'rgba(59, 59, 59, 0.7)',
      backgroundColor: 'rgba(59, 59, 59, 0.5)',
    }

    pushData = [];
    switch (status) {
      case references.HIGH.High:
        pushData.push(dataHigh);
        break;
      case references.MEDIUM.Medium:
        pushData.push(dataMedium);
        break;
      case references.LOW.Low:
        pushData.push(dataLow);
        break;
      case "Sin Dato":
        pushData.push(dataNoLevel);
        break;
      default:
        pushData.push(dataHigh);
        pushData.push(dataMedium);
        pushData.push(dataLow);
        pushData.push(dataNoLevel);
        break;
    }

    tbl_framingham.rows.add(registerAdd).draw();

    tbl_framingham.on('draw.dt', function () {
      let data_select = $("#FraminghamOpc").val();
      if (!data_select || data_select === "TODAS") {
        var rows = $('#tbl_framingham tbody tr');
        for (var i = 0; i < rows.length; i += 4) {
          var rowspan = 4;
          rows.eq(i).find('td:eq(0)').attr('rowspan', rowspan);
          rows.eq(i).find('td:eq(1)').attr('overflow', 'hidden');
          rows.eq(i).find('td:eq(2)').attr('overflow', 'hidden');

          // Ocultar las celdas en las filas cubiertas por rowspan
          if (rowspan > 1) {
            rows.slice(i + 1, i + rowspan).find('td:eq(0)').hide();
          }
        }
      }
    });


    let typeGraph = 'line';
    let elements = {
      line: {
        tension: 0.3,
        fill: true
      }
    };
    let animations = {
      tension: {
        duration: 1000,
        easing: 'easeInOutQuad',
        from: 0.2,
        to: 0,
        loop: true
      }
    }
    if (centrals.length == 1) {
      typeGraph = 'bar';
      elements = {
        bar: {
          borderWidth: 2,
          borderRadius: 5,
        }
      }
      animations = {
        borderRadius: {
          from: 0,
          to: 5,
          duration: 1000,
          easing: 'easeInOutQuad',
          loop: true
        }
      }
    }

    graphFramingham = new Chart(framinghamChart, {
      type: typeGraph,
      data: {
        labels: centrals.sort(),
        datasets: pushData
      },
      options: {
        elements: elements,
        plugins: {
          tooltip: {
            mode: 'index',
            axis: "y",
            position: "nearest",
            backgroundColor: 'rgba(0, 0, 0, 0.6)'
          },
          title: {
            display: true,
            text: "Test de Framingham",
            color: '#704736',
            font: {
              size: 30,
              weight: 'bold',
              lineHeight: 1.2,
            }
          }
        },
        animations,
      }
    });
  }

  function testMetabolic(params = "", central = "", status = "") {
    let centrals = [];
    let withAlterations = [];
    let withoutAlterations = [];
    let requiredData = [];
    let pushData = [];
    const metabolicChart = document.getElementById("myMetabolic");

    if (central || status) {
      graphMetabolic.destroy();
      tbl_metabolic.clear().draw();
    }

    params.forEach(element => {
      if (!centrals.includes(element[3])) {
        centrals.push(element[3]);
      }
    })

    if (!status) {
      $("#MetabolicOpc").empty();
      $("#MetabolicOpc").append(`<option value=""></option>`);
      $("#MetabolicOpc").append(`<option value="TODAS">TODAS</option>`);
      $("#MetabolicOpc").append(`<option value="${referencesMetabolic.withAlterations.message}">${referencesMetabolic.withAlterations.message}</option>`);
      $("#MetabolicOpc").append(`<option value="${referencesMetabolic.withoutAlterations.message}">${referencesMetabolic.withoutAlterations.message}</option>`);
      $("#MetabolicOpc").append(`<option value="${referencesMetabolic.requiredData.message}">${referencesMetabolic.requiredData.message}</option>`);
    }

    let registerAdd = [];

    centrals.sort().forEach(central => {
      let withAlterationsRegister = [], withoutAlterationsRegister = [], requiredDataRegister = [];
      referencesMetabolic.withAlterations.Counter = 0;
      referencesMetabolic.withoutAlterations.Counter = 0;
      referencesMetabolic.requiredData.Counter = 0;
      params.forEach(register => {
        if (register[3] === central && register[26].includes(referencesMetabolic.withAlterations.message)) {
          if (status && register[26].includes(status)) {
            referencesMetabolic.withAlterations.Counter++;
            withAlterationsRegister.push(`${register[7]}-${register[5]}`);
          } else {
            referencesMetabolic.withAlterations.Counter++;
            withAlterationsRegister.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[26].includes(referencesMetabolic.withoutAlterations.message)) {
          if (status && register[26].includes(status)) {
            referencesMetabolic.withoutAlterations.Counter++;
            withoutAlterationsRegister.push(`${register[7]}-${register[5]}`);
          } else {
            referencesMetabolic.withoutAlterations.Counter++;
            withoutAlterationsRegister.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[26].includes(referencesMetabolic.requiredData.message)) {
          if (status && register[26].includes(status)) {
            referencesMetabolic.requiredData.Counter++;
            requiredDataRegister.push(`${register[7]}-${register[5]}`);
          } else {
            referencesMetabolic.requiredData.Counter++;
            requiredDataRegister.push(`${register[7]}-${register[5]}`);
          }
        }
      })

      let btnWithAlterations, btnWithoutAlterations, btnRequiredData;

      if (status.includes(referencesMetabolic.withAlterations.message)) {
        btnWithAlterations = `0`;

        if (referencesMetabolic.withAlterations.Counter > 0) {
          btnWithAlterations = `<button type="button" class="btn badge bg-danger rounded-pill high" data-info="${withAlterationsRegister}" data-color="danger" data-central="${central}" data-evaluation="${referencesMetabolic.withAlterations.message}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesMetabolic.withAlterations.Counter}</button>`;
        }

        registerAdd.push({
          0: central,
          1: referencesMetabolic.withAlterations.message,
          2: btnWithAlterations
        })
      } else if (status.includes(referencesMetabolic.withoutAlterations.message)) {
        btnWithoutAlterations = `0`;

        if (referencesMetabolic.withoutAlterations.Counter > 0) {
          btnWithoutAlterations = `<button type="button" class="btn badge bg-success rounded-pill high" data-info="${withoutAlterationsRegister}" data-color="success" data-central="${central}" data-evaluation="${referencesMetabolic.withoutAlterations.message}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesMetabolic.withoutAlterations.Counter}</button>`;
        }
        registerAdd.push({
          0: central,
          1: referencesMetabolic.withoutAlterations.message,
          2: btnWithoutAlterations
        })
      } else if (status.includes(referencesMetabolic.requiredData.message)) {
        btnRequiredData = `0`;

        if (referencesMetabolic.requiredData.Counter > 0) {
          btnRequiredData = `<button type="button" class="btn badge bg-dark rounded-pill high" data-info="${requiredDataRegister}" data-color="dark" data-central="${central}" data-evaluation="${referencesMetabolic.requiredData.message}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesMetabolic.requiredData.Counter}</button>`;
        }
        registerAdd.push({
          0: central,
          1: referencesMetabolic.requiredData.message,
          2: btnRequiredData
        })
      } else {
        btnWithAlterations = `0`;

        if (referencesMetabolic.withAlterations.Counter > 0) {
          btnWithAlterations = `<button type="button" class="btn badge bg-danger rounded-pill high" data-info="${withAlterationsRegister}" data-color="danger" data-central="${central}" data-evaluation="${referencesMetabolic.withAlterations.message}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesMetabolic.withAlterations.Counter}</button>`;
        }

        registerAdd.push({
          0: central,
          1: referencesMetabolic.withAlterations.message,
          2: btnWithAlterations
        })

        btnWithoutAlterations = `0`;

        if (referencesMetabolic.withoutAlterations.Counter > 0) {
          btnWithoutAlterations = `<button type="button" class="btn badge bg-success rounded-pill high" data-info="${withoutAlterationsRegister}" data-color="success" data-central="${central}" data-evaluation="${referencesMetabolic.withoutAlterations.message}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesMetabolic.withoutAlterations.Counter}</button>`;
        }
        registerAdd.push({
          0: central,
          1: referencesMetabolic.withoutAlterations.message,
          2: btnWithoutAlterations
        })

        btnRequiredData = `0`;

        if (referencesMetabolic.requiredData.Counter > 0) {
          btnRequiredData = `<button type="button" class="btn badge bg-dark rounded-pill high" data-info="${requiredDataRegister}" data-color="dark" data-central="${central}" data-evaluation="${referencesMetabolic.requiredData.message}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesMetabolic.requiredData.Counter}</button>`;
        }
        registerAdd.push({
          0: central,
          1: referencesMetabolic.requiredData.message,
          2: btnRequiredData
        })
      }

      withAlterations.push(referencesMetabolic.withAlterations.Counter);
      withoutAlterations.push(referencesMetabolic.withoutAlterations.Counter);
      requiredData.push(referencesMetabolic.requiredData.Counter);
    })

    let dataWithAlteration, dataWithoutAlteration, dataRequiredData;

    dataWithAlteration = {
      label: referencesMetabolic.withAlterations.message,
      data: withAlterations,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      backgroundColor: 'rgba(82, 35, 20, 0.5)',
      borderColor: 'rgb(82, 35, 20)',
    }

    dataWithoutAlteration = {
      label: referencesMetabolic.withoutAlterations.message,
      data: withoutAlterations,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      backgroundColor: 'rgba(73, 19, 117, 0.5)',
      borderColor: 'rgb(73, 19, 117)',
    }

    dataRequiredData = {
      label: referencesMetabolic.requiredData.message,
      data: requiredData,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      backgroundColor: 'rgba(20, 82, 76, 0.5)',
      borderColor: 'rgb(20, 82, 76)',
    }

    pushData = [];
    if (status.includes(referencesMetabolic.withAlterations.message)) {
      pushData.push(dataWithAlteration);
    } else if (status.includes(referencesMetabolic.withoutAlterations.message)) {
      pushData.push(dataWithoutAlteration);
    } else if (status.includes(referencesMetabolic.requiredData.message)) {
      pushData.push(dataRequiredData);
    } else {
      pushData.push(dataWithAlteration);
      pushData.push(dataWithoutAlteration);
      pushData.push(dataRequiredData);
    }

    tbl_metabolic.rows.add(registerAdd).draw();

    tbl_metabolic.on('draw.dt', function () {
      let data_select = $("#MetabolicOpc").val();
      if (!data_select || data_select === 'TODAS') {
        var rows = $('#tbl_metabolic tbody tr');
        for (var i = 0; i < rows.length; i += 3) {
          var rowspan = 3;
          rows.eq(i).find('td:eq(0)').attr('rowspan', rowspan);
          rows.eq(i).find('td:eq(1)').attr('overflow', 'hidden');
          rows.eq(i).find('td:eq(2)').attr('overflow', 'hidden');

          // Ocultar las celdas en las filas cubiertas por rowspan
          if (rowspan > 1) {
            rows.slice(i + 1, i + rowspan).find('td:eq(0)').hide();
          }
        }
      }
    });

    let typeGraph = 'line';
    let elements = {
      line: {
        tension: 0.3,
        fill: true
      }
    };
    let animations = {
      tension: {
        duration: 1000,
        easing: 'easeInOutQuad',
        from: 0.2,
        to: 0,
        loop: true
      }
    }
    if (centrals.length == 1) {
      typeGraph = 'bar';
      elements = {
        bar: {
          borderWidth: 2,
          borderRadius: 5,
        }
      }
      animations = {
        borderRadius: {
          from: 0,
          to: 5,
          duration: 1000,
          easing: 'easeInOutQuad',
          loop: true
        }
      }
    }

    graphMetabolic = new Chart(metabolicChart, {
      type: typeGraph,
      data: {
        labels: centrals.sort(),
        datasets: pushData
      },
      options: {
        elements: elements,
        plugins: {
          tooltip: {
            mode: 'index',
            axis: "y",
            position: "nearest",
            backgroundColor: 'rgba(0, 0, 0, 0.6)'
          },
          title: {
            display: true,
            text: "Síndrome Metabólico",
            color: '#704736',
            font: {
              size: 30,
              weight: 'bold',
              lineHeight: 1.2,
            }
          }
        },
        animations,
      }
    });
  }

  function testAterogenic(params = "", central = "", status = "") {
    let centrals = [];
    let max = [];
    let medium = [];
    let min = [];
    const arterogenicChart = document.getElementById("myArterogenic");

    if (central || status) {
      graphArterogenic.destroy();
      tbl_aterogenic.clear().draw();
    }

    params.forEach(element => {
      if (!centrals.includes(element[3])) {
        centrals.push(element[3]);
      }
    })

    if (!status) {
      $("#AterogenicOpc").empty();
      $("#AterogenicOpc").append(`<option value=""></option>`);
      $("#AterogenicOpc").append(`<option value="TODAS">TODAS</option>`);
      $("#AterogenicOpc").append(`<option value="${referencesAterogenic.HIGH.High}">${referencesAterogenic.HIGH.High}</option>`);
      $("#AterogenicOpc").append(`<option value="${referencesAterogenic.MEDIUM.Medium}">${referencesAterogenic.MEDIUM.Medium}</option>`);
      $("#AterogenicOpc").append(`<option value="${referencesAterogenic.LOW.Low}">${referencesAterogenic.LOW.Low}</option>`);
    }

    let registerAdd = [];
    centrals.sort().forEach(central => {
      let highRegisters = [], mediumRegisters = [], lowRegisters = [];
      referencesAterogenic.HIGH.Counter = 0;
      referencesAterogenic.MEDIUM.Counter = 0;
      referencesAterogenic.LOW.Counter = 0;
      params.forEach(register => {
        if (register[3] === central && register[27].includes(referencesAterogenic.HIGH.High)) {
          if (status && register[27].includes(status)) {
            referencesAterogenic.HIGH.Counter++;
            highRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            referencesAterogenic.HIGH.Counter++;
            highRegisters.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[27].includes(referencesAterogenic.MEDIUM.Medium)) {
          if (status && register[27].includes(status)) {
            referencesAterogenic.MEDIUM.Counter++;
            mediumRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            referencesAterogenic.MEDIUM.Counter++;
            mediumRegisters.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[27].includes(referencesAterogenic.LOW.Low)) {
          if (status && register[27].includes(status)) {
            referencesAterogenic.LOW.Counter++;
            lowRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            referencesAterogenic.LOW.Counter++;
            lowRegisters.push(`${register[7]}-${register[5]}`);
          }
        }
      })

      let btnHigh, btnMedium, btnLow;

      switch (status) {
        case referencesAterogenic.HIGH.High:
          btnHigh = `0`;

          if (referencesAterogenic.HIGH.Counter > 0) {
            btnHigh = `<button type="button" class="btn badge bg-danger rounded-pill high" data-info="${highRegisters}" data-color="danger" data-central="${central}" data-evaluation="${referencesAterogenic.HIGH.High}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesAterogenic.HIGH.Counter}</button>`;
          }

          registerAdd.push({
            0: central,
            1: referencesAterogenic.HIGH.High,
            2: btnHigh
          })
          break;
        case referencesAterogenic.MEDIUM.Medium:
          btnMedium = `0`;

          if (referencesAterogenic.MEDIUM.Counter > 0) {
            btnMedium = `<button type="button" class="btn badge bg-warning rounded-pill high" data-info="${mediumRegisters}" data-color="warning" data-central="${central}" data-evaluation="${referencesAterogenic.MEDIUM.Medium}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesAterogenic.MEDIUM.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: referencesAterogenic.MEDIUM.Medium,
            2: btnMedium
          })
          break;
        case referencesAterogenic.LOW.Low:
          btnLow = `0`;

          if (referencesAterogenic.LOW.Counter > 0) {
            btnLow = `<button type="button" class="btn badge bg-success rounded-pill high" data-info="${lowRegisters}" data-color="success" data-central="${central}" data-evaluation="${referencesAterogenic.LOW.Low}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesAterogenic.LOW.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: referencesAterogenic.LOW.Low,
            2: btnLow
          })
          break;
        default:
          btnHigh = `0`;

          if (referencesAterogenic.HIGH.Counter > 0) {
            btnHigh = `<button type="button" class="btn badge bg-danger rounded-pill high" data-info="${highRegisters}" data-color="danger" data-central="${central}" data-evaluation="${referencesAterogenic.HIGH.High}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesAterogenic.HIGH.Counter}</button>`;
          }

          registerAdd.push({
            0: central,
            1: referencesAterogenic.HIGH.High,
            2: btnHigh
          })

          btnMedium = `0`;

          if (referencesAterogenic.MEDIUM.Counter > 0) {
            btnMedium = `<button type="button" class="btn badge bg-warning rounded-pill high" data-info="${mediumRegisters}" data-color="warning" data-central="${central}" data-evaluation="${referencesAterogenic.MEDIUM.Medium}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesAterogenic.MEDIUM.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: referencesAterogenic.MEDIUM.Medium,
            2: btnMedium
          })

          btnLow = `0`;

          if (referencesAterogenic.LOW.Counter > 0) {
            btnLow = `<button type="button" class="btn badge bg-success rounded-pill high" data-info="${lowRegisters}" data-color="success" data-central="${central}" data-evaluation="${referencesAterogenic.LOW.Low}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${referencesAterogenic.LOW.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: referencesAterogenic.LOW.Low,
            2: btnLow
          })
          break;
      }

      max.push(referencesAterogenic.HIGH.Counter);
      medium.push(referencesAterogenic.MEDIUM.Counter);
      min.push(referencesAterogenic.LOW.Counter);
    })

    let dataMax, dataMedium, dataMin;

    dataMax = {
      label: referencesAterogenic.HIGH.High,
      data: max,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      backgroundColor: 'rgba(3, 152, 252, 0.5)',
      borderColor: 'rgb(3, 152, 252)',
    }

    dataMedium = {
      label: referencesAterogenic.MEDIUM.Medium,
      data: medium,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      backgroundColor: 'rgba(252, 152, 3, 0.5)',
      borderColor: 'rgb(252, 152, 3)',
    }

    dataMin = {
      label: referencesAterogenic.LOW.Low,
      data: min,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      backgroundColor: 'rgba(128, 3, 252, 0.5)',
      borderColor: 'rgb(128, 3, 252)',
    }

    pushData = [];
    switch (status) {
      case referencesAterogenic.HIGH.High:
        pushData.push(dataMax);
        break;
      case referencesAterogenic.MEDIUM.Medium:
        pushData.push(dataMedium);
        break;
      case referencesAterogenic.LOW.Low:
        pushData.push(dataMin);
        break;
      default:
        pushData.push(dataMax);
        pushData.push(dataMedium);
        pushData.push(dataMin);
        break;
    }

    tbl_aterogenic.rows.add(registerAdd).draw();

    tbl_aterogenic.on('draw.dt', function () {
      let data_select = $('#AterogenicOpc').val();
      if (!data_select || data_select === 'TODAS') {
        var rows = $('#tbl_aterogenic tbody tr');
        for (var i = 0; i < rows.length; i += 3) {
          var rowspan = 3;
          rows.eq(i).find('td:eq(0)').attr('rowspan', rowspan);
          rows.eq(i).find('td:eq(1)').attr('overflow', 'hidden');
          rows.eq(i).find('td:eq(2)').attr('overflow', 'hidden');

          // Ocultar las celdas en las filas cubiertas por rowspan
          if (rowspan > 1) {
            rows.slice(i + 1, i + rowspan).find('td:eq(0)').hide();
          }
        }
      }
    });

    let typeGraph = 'line';
    let elements = {
      line: {
        tension: 0.3,
        fill: true
      }
    };
    let animations = {
      tension: {
        duration: 1000,
        easing: 'easeInOutQuad',
        from: 0.2,
        to: 0,
        loop: true
      }
    }
    if (centrals.length == 1) {
      typeGraph = 'bar';
      elements = {
        bar: {
          borderWidth: 2,
          borderRadius: 5,
        }
      }
      animations = {
        borderRadius: {
          from: 0,
          to: 5,
          duration: 1000,
          easing: 'easeInOutQuad',
          loop: true
        }
      }
    }

    graphArterogenic = new Chart(arterogenicChart, {
      type: typeGraph,
      data: {
        labels: centrals.sort(),
        datasets: pushData
      },
      options: {
        elements: elements,
        plugins: {
          tooltip: {
            mode: 'index',
            axis: "y",
            position: "nearest",
            backgroundColor: 'rgba(0, 0, 0, 0.6)'
          },
          title: {
            display: true,
            text: "Indice Aterogenico",
            color: '#704736',
            font: {
              size: 30,
              weight: 'bold',
              lineHeight: 1.2,
            }
          }
        },
        animations,
      }
    });
  }

  function interventionInfo(params = "", central = "", status = "") {
    let centrals = [];
    let highValue = [];
    let mediumValue = [];
    let lowValue = [];
    let noClasificationValue = [];
    let pushData = [];
    const interventionChart = document.getElementById("myIntervention");

    if (central || status) {
      graphIntervention.destroy();
      tbl_intervention.clear().draw();
    }

    params.forEach(element => {
      if (!centrals.includes(element[3])) {
        centrals.push(element[3]);
      }
    })

    if (!status) {
      $("#InterventionOpc").empty();
      $("#InterventionOpc").append("<option value=''></option>");
      $("#InterventionOpc").append("<option value='TODAS'>TODAS</option>");
      $("#InterventionOpc").append(`<option value="${references.HIGH.High}">${references.HIGH.High}</option>`);
      $("#InterventionOpc").append(`<option value="${references.MEDIUM.Medium}">${references.MEDIUM.Medium}</option>`);
      $("#InterventionOpc").append(`<option value="${references.LOW.Low}">${references.LOW.Low}</option>`);
      $("#InterventionOpc").append(`<option value="Sin Clasificación los parametros no corresponden">Sin Clasificación</option>`);
    }

    let registerAdd = [];
    centrals.sort().forEach(central => {
      let highRegisters = [], mediumRegisters = [], lowRegisters = [], noLevelRegisters = [];
      references.HIGH.Counter = 0;
      references.MEDIUM.Counter = 0;
      references.LOW.Counter = 0;
      references.NOLEVEL.Counter = 0;
      params.forEach(register => {
        if (register[3] === central && register[28].includes(references.HIGH.High.toLocaleUpperCase())) {
          if (status && register[28].includes(status.toLocaleUpperCase())) {
            references.HIGH.Counter++;
            highRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            references.HIGH.Counter++;
            highRegisters.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[28].includes(references.MEDIUM.Medium.toLocaleUpperCase())) {
          if (status && register[28].includes(status.toLocaleUpperCase())) {
            references.MEDIUM.Counter++;
            mediumRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            references.MEDIUM.Counter++;
            mediumRegisters.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[28].includes(references.LOW.Low.toLocaleUpperCase())) {
          if (status && register[28].includes(status.toLocaleUpperCase())) {
            references.LOW.Counter++;
            lowRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            references.LOW.Counter++;
            lowRegisters.push(`${register[7]}-${register[5]}`);
          }
        } else if (register[3] === central && register[28].includes(`Sin Clasificación los parametros no corresponden`)) {
          if (status && register[28].includes(`Sin Clasificación los parametros no corresponden`)) {
            references.NOLEVEL.Counter++;
            noLevelRegisters.push(`${register[7]}-${register[5]}`);
          } else {
            references.NOLEVEL.Counter++;
            noLevelRegisters.push(`${register[7]}-${register[5]}`);
          }
        }
      })

      let btnHigh, btnMedium, btnLow, btnNoLevel;

      debugger;
      switch (status) {
        case references.HIGH.High:
          btnHigh = `0`;

          if (references.HIGH.Counter > 0) {
            btnHigh = `<button type="button" class="btn badge bg-danger rounded-pill high" data-info="${highRegisters}" data-color="danger" data-central="${central}" data-evaluation="${references.HIGH.High}"   data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.HIGH.Counter}</button>`;
          }

          registerAdd.push({
            0: central,
            1: references.HIGH.High,
            2: btnHigh
          })
          break;
        case references.MEDIUM.Medium:
          btnMedium = `0`;

          if (references.MEDIUM.Counter > 0) {
            btnMedium = `<button type="button" class="btn badge bg-warning rounded-pill high" data-info="${mediumRegisters}" data-color="warning" data-central="${central}" data-evaluation="${references.MEDIUM.Medium}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.MEDIUM.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: references.MEDIUM.Medium,
            2: btnMedium
          })
          break;
        case references.LOW.Low:
          btnLow = `0`;

          if (references.LOW.Counter > 0) {
            btnLow = `<button type="button" class="btn badge bg-success rounded-pill high" data-info="${lowRegisters}" data-color="success" data-central="${central}" data-evaluation="${references.LOW.Low}"    data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.LOW.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: references.LOW.Low,
            2: btnLow
          })
          break;
        case `Sin Clasificación`:
          btnNoLevel = `0`;

          if (references.NOLEVEL.Counter > 0) {
            btnNoLevel = `<button type="button" class="btn badge bg-dark rounded-pill high" data-info="${noLevelRegisters}" data-color="dark" data-central="${central}" data-evaluation="Sin Clasificación" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.NOLEVEL.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: "Sin Clasificación",
            2: btnNoLevel
          })
          break;
        default:
          btnHigh = `0`;

          if (references.HIGH.Counter > 0) {
            btnHigh = `<button type="button" class="btn badge bg-danger rounded-pill high" data-info="${highRegisters}" data-color="danger" data-central="${central}" data-evaluation="${references.HIGH.High}"   data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.HIGH.Counter}</button>`;
          }

          registerAdd.push({
            0: central,
            1: references.HIGH.High,
            2: btnHigh
          })

          btnMedium = `0`;

          if (references.MEDIUM.Counter > 0) {
            btnMedium = `<button type="button" class="btn badge bg-warning rounded-pill high" data-info="${mediumRegisters}" data-color="warning" data-central="${central}" data-evaluation="${references.MEDIUM.Medium}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.MEDIUM.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: references.MEDIUM.Medium,
            2: btnMedium
          })

          btnLow = `0`;

          if (references.LOW.Counter > 0) {
            btnLow = `<button type="button" class="btn badge bg-success rounded-pill high" data-info="${lowRegisters}" data-color="success" data-central="${central}" data-evaluation="${references.LOW.Low}"    data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.LOW.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: references.LOW.Low,
            2: btnLow
          })

          btnNoLevel = `0`;

          if (references.NOLEVEL.Counter > 0) {
            btnNoLevel = `<button type="button" class="btn badge bg-dark rounded-pill high" data-info="${noLevelRegisters}" data-color="dark" data-central="${central}" data-evaluation="Sin Clasificación" data-bs-toggle="modal" data-bs-target="#staticBackdrop">${references.NOLEVEL.Counter}</button>`;
          }
          registerAdd.push({
            0: central,
            1: "Sin Clasificación",
            2: btnNoLevel
          })
          break;
      }

      highValue.push(references.HIGH.Counter)
      mediumValue.push(references.MEDIUM.Counter)
      lowValue.push(references.LOW.Counter)
      noClasificationValue.push(references.NOLEVEL.Counter)
    })

    let dataHigh, dataMedium, dataLow, dataNoLevel;

    /*** data for the High, Medium and Low graphs ***/
    dataHigh = {
      label: references.HIGH.High,
      data: highValue,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      borderColor: 'rgba(123, 48, 12, 0.7)',
      backgroundColor: 'rgba(123, 48, 12, 0.5)',
    }
    dataMedium = {
      label: references.MEDIUM.Medium,
      data: mediumValue,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      borderColor: 'rgba(255, 186, 30, 0.7)',
      backgroundColor: 'rgba(255, 186, 30, 0.5)',
    }
    dataLow = {
      label: references.LOW.Low,
      data: lowValue,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      borderColor: 'rgba(47, 69, 255, 0.7)',
      backgroundColor: 'rgba(47, 69, 255, 0.5)',
    }
    dataNoLevel = {
      label: "Sin Clasificación",
      data: noClasificationValue,
      pointStyle: 'rectRounded',
      pointRadius: 6,
      borderColor: 'rgba(59, 59, 59, 0.7)',
      backgroundColor: 'rgba(59, 59, 59, 0.5)',
    }

    pushData = [];
    switch (status) {
      case references.HIGH.High:
        pushData.push(dataHigh);
        break;
      case references.MEDIUM.Medium:
        pushData.push(dataMedium);
        break;
      case references.LOW.Low:
        pushData.push(dataLow);
        break;
      case "Sin Clasificación":
        pushData.push(dataNoLevel);
        break;
      default:
        pushData.push(dataHigh);
        pushData.push(dataMedium);
        pushData.push(dataLow);
        pushData.push(dataNoLevel);
        break;
    }

    tbl_intervention.rows.add(registerAdd).draw();

    tbl_intervention.on('draw.dt', function () {
      let data_select = $("#InterventionOpc").val();
      if (!data_select || data_select === "TODAS") {
        var rows = $('#tbl_Intervention tbody tr');
        for (var i = 0; i < rows.length; i += 4) {
          var rowspan = 4;
          rows.eq(i).find('td:eq(0)').attr('rowspan', rowspan);
          rows.eq(i).find('td:eq(1)').attr('overflow', 'hidden');
          rows.eq(i).find('td:eq(2)').attr('overflow', 'hidden');

          // Ocultar las celdas en las filas cubiertas por rowspan
          if (rowspan > 1) {
            rows.slice(i + 1, i + rowspan).find('td:eq(0)').hide();
          }
        }
      }
    });

    let typeGraph = 'line';
    let elements = {
      line: {
        tension: 0.3,
        fill: true
      }
    };
    let animations = {
      tension: {
        duration: 1000,
        easing: 'easeInOutQuad',
        from: 0.2,
        to: 0,
        loop: true
      }
    }
    if (centrals.length == 1) {
      typeGraph = 'bar';
      elements = {
        bar: {
          borderWidth: 2,
          borderRadius: 5,
        }
      }
      animations = {
        borderRadius: {
          from: 0,
          to: 5,
          duration: 1000,
          easing: 'easeInOutQuad',
          loop: true
        }
      }
    }

    graphIntervention = new Chart(interventionChart, {
      type: typeGraph,
      data: {
        labels: centrals.sort(),
        datasets: pushData
      },
      options: {
        elements: elements,
        plugins: {
          tooltip: {
            mode: 'index',
            axis: "y",
            position: "nearest",
            backgroundColor: 'rgba(0, 0, 0, 0.6)'
          },
          title: {
            display: true,
            text: "Clasificación Final para la Intervención",
            color: '#704736',
            font: {
              size: 30,
              weight: 'bold',
              lineHeight: 1.2,
            }
          }
        },
        animations,
      }
    });
  }

  function general(selected) {
    let months = ['flush-collapseOne', 'flush-collapseTwo', 'flush-collapseThree', 'flush-collapseFour', 'flush-collapseFive', 'flush-collapseSix', 'flush-collapseSeven', 'flush-collapseEight', 'flush-collapseNine', 'flush-collapseTen', 'flush-collapseEleven', 'flush-collapseTwelve'];
    let generalInfo = google.script.run.withSuccessHandler(element => {
      let row = JSON.parse(element);
      let icon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                    <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" />
                    <path fill-rule="evenodd" d="M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                  </svg>`;

      let insertRow = [];
      if (selected) {
        tbl_general.clear().draw();
      }

      row.forEach(register => {
        let monthsData = [];
        let training = 29, dateThemeTraining = 30, workshop = 31, dateThemeWorkshop = 32, dateTracking = 33, diagnosticCV = 34, observationTracking = 35, valNutritional = 36, observationNutritional = 37, datePhysiotherapy = 38, observationPhysiotherapy = 39, datePsychology = 40, observationPsychology = 41, GYM = 42;

        months.forEach(month => {
          let dataInside = [];

          dataInside.push(`${month},Capacitación(asiste / no asiste),${(register[training] == "") ? "Sin Dato" : register[training]}`);
          dataInside.push(`Fecha / Tema Capacitación,${(register[dateThemeTraining] == "") ? "Sin Dato" : register[dateThemeTraining]}`);
          dataInside.push(`Talleres / Círculos(asiste / no asiste),${(register[workshop] == "") ? "Sin Dato" : register[workshop]}`);
          dataInside.push(`Fecha / Tema Taller,${(register[dateThemeWorkshop] == "") ? "Sin Dato" : register[dateThemeWorkshop]}`);
          dataInside.push(`Seguimiento Médico(fecha),${(register[dateTracking] == "") ? "Sin Dato" : register[dateTracking]}`);
          dataInside.push(`Diagnosticos CV,${(register[diagnosticCV] == "") ? "Sin Dato" : register[diagnosticCV]}`);
          dataInside.push(`Observación de Seguimiento,${(register[observationTracking] == "") ? "Sin Dato" : register[observationTracking]}`);
          dataInside.push(`Val. Nutricional(fecha),${(register[valNutritional] == "") ? "Sin Dato" : register[valNutritional]}`);
          dataInside.push(`Observación Nutricionales,${(register[observationNutritional] == "") ? "Sin Dato" : register[observationNutritional]}`);
          dataInside.push(`Val. Fisioterapia/Deportologo/Prof. Deportes(fecha),${(register[datePhysiotherapy] == "") ? "Sin Dato" : register[datePhysiotherapy]}`);
          dataInside.push(`Observación Fisioterapia/Deportologo/Prof. Deportes,${(register[observationPhysiotherapy] == "") ? "Sin Dato" : register[observationPhysiotherapy]}`);
          dataInside.push(`Val. Psicología(fecha),${(register[datePsychology] == "") ? "Sin Dato" : register[datePsychology]}`);
          dataInside.push(`Observación Psicología,${(register[observationPsychology] == "") ? "Sin Dato" : register[observationPsychology]}`);
          dataInside.push(`GYM,${(register[GYM] == "") ? "Sin Dato" : register[GYM]}`);

          monthsData.push(dataInside);

          training += 14;
          dateThemeTraining += 14;
          workshop += 14;
          dateThemeWorkshop += 14;
          dateTracking += 14;
          diagnosticCV += 14;
          observationTracking += 14;
          valNutritional += 14;
          observationNutritional += 14;
          datePhysiotherapy += 14;
          observationPhysiotherapy += 14;
          datePsychology += 14;
          observationPsychology += 14;
          GYM += 14;
        });

        insertRow.push({
          0: register[1],
          1: register[2],
          2: register[3],
          3: register[4],
          4: register[5],
          5: register[7],
          6: register[10],
          7: `<button type="button" class="btn btn-primary btn-sm d-flex infoGeneral" style="width: 2.5em!important; height: 2.5em!important;" data-bs-toggle="modal" data-bs-target="#totalInfo" data-gerencia="${register[1]}" data-examen="${register[2]}" data-central="${register[3]}" data-paciente="${register[5]}" data-identificacion="${register[7]}" data-cargo="${register[10]}" data-sexo="${register[9]}" data-edad="${register[8]}" data-framingham="${register[25]}" data-metabolico="${register[26]}" data-aterogenico="${register[27]}" data-final="${register[28]}" data-months="${monthsData}">${icon}</button>`
        })
      });

      tbl_general.rows.add(insertRow).draw();

      /*** instanciación de la gráficas ***/
      testFramingham(row, selected);
      testMetabolic(row, selected);
      testAterogenic(row, selected);
      interventionInfo(row, selected);


      let rowsFramingham = $('#tbl_framingham tbody tr');
      for (let i = 0; i < rowsFramingham.length; i += 4) {
        let rowspan = 4;
        rowsFramingham.eq(i).find('td:eq(0)').attr('rowspan', rowspan);
        rowsFramingham.eq(i).find('td:eq(1)').addClass('d-clamp');
        rowsFramingham.eq(i).find('td:eq(2)').addClass('d-clamp');

        // Ocultar las celdas en las filas cubiertas por rowspan
        if (rowspan > 1) {
          rowsFramingham.slice(i + 1, i + rowspan).find('td:eq(0)').hide();
        }
      }

      let rowsIntervention = $('#tbl_Intervention tbody tr');
      for (let i = 0; i < rowsIntervention.length; i += 4) {
        let rowspan = 4;
        rowsIntervention.eq(i).find('td:eq(0)').attr('rowspan', rowspan);
        rowsIntervention.eq(i).find('td:eq(1)').addClass('d-clamp');
        rowsIntervention.eq(i).find('td:eq(2)').addClass('d-clamp');

        // Ocultar las celdas en las filas cubiertas por rowspan
        if (rowspan > 1) {
          rowsIntervention.slice(i + 1, i + rowspan).find('td:eq(0)').hide();
        }
      }

      let rowsMetabolic = $('#tbl_metabolic tbody tr');
      for (let i = 0; i < rowsMetabolic.length; i += 3) {
        let rowspan = 3;
        rowsMetabolic.eq(i).find('td:eq(0)').attr('rowspan', rowspan);
        rowsMetabolic.eq(i).find('td:eq(1)').addClass('d-clamp');
        rowsMetabolic.eq(i).find('td:eq(2)').addClass('d-clamp');

        // Ocultar las celdas en las filas cubiertas por rowspan
        if (rowspan > 1) {
          rowsMetabolic.slice(i + 1, i + rowspan).find('td:eq(0)').hide();
        }
      }

      let rowsAterogenic = $('#tbl_aterogenic tbody tr');
      for (let i = 0; i < rowsAterogenic.length; i += 3) {
        let rowspan = 3;
        rowsAterogenic.eq(i).find('td:eq(0)').attr('rowspan', rowspan);
        rowsAterogenic.eq(i).find('td:eq(1)').addClass('d-clamp');
        rowsAterogenic.eq(i).find('td:eq(2)').addClass('d-clamp');

        // Ocultar las celdas en las filas cubiertas por rowspan
        if (rowspan > 1) {
          rowsAterogenic.slice(i + 1, i + rowspan).find('td:eq(0)').hide();
        }
      }

      if (selected) {
        Swal.fire({
          icon: 'success',
          title: "Good job!",
          showConfirmButton: false,
          timer: 2000
        });
      }
    })
      .withFailureHandler(error => {
        console.log(error);
      })
    if (selected) {
      generalInfo.getGeneral(selected);
    } else {
      generalInfo.getGeneral();
    }
  }
</script>